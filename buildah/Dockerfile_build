###################
## Build the go app
###################
FROM golang:1.16-alpine as builder
ENV CGO_ENABLED 0

WORKDIR /go/src/buildah-app
COPY ./code/ .

# Install the needed packages
RUN apk add --no-cache \
    gpgme \
    gpgme-dev

# Build the buildah app using compilation flags
RUN GOOS=linux GOARCH=amd64 go build -o /buildah-app *.go

#####################################
# Setup the env to run the buildah app
#####################################
FROM registry.access.redhat.com/ubi8-minimal

COPY --from=builder /buildah-app /buildah-app

WORKDIR /workspace

ENTRYPOINT ["/buildah-app"]
